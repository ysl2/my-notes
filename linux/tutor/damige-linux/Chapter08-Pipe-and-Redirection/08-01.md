# Linux 管道与重定向

## 管道

### 管道符做过滤器使用

| 过滤方式 | 含义                                  |
| -------- | ------------------------------------- |
| grep     | 过滤字符，`-v`反向过滤                |
| head     | 查看头部， `-n`指定行数               |
| tail     | 查看尾部， `-n`指定行数               |

grep举例：

```bash
# 输出分区信息，但是只输出含centos的字段
df -h | grep "centos"
# centos周围的引号可以不加

# 支持正则表达式
# 只输出以p开头的信息
df -h | grep "^p"

# 输出分区信息，但是过滤掉含centos的字段
df -h | grep -v centos
```

head/tail举例：

```bash
# 打印前两行
df -h | head -n 2
```

### awk：编程过滤

awk：以编程方式过滤。

awk举例：

```bash
# 以空格分隔打印第一列（默认就是以空格分隔，因此此处-F可省略）
ls -l | awk -F " " '{print $1}'
# print $1  表示打印第1列
```

以编程的方式使用awk

```bash
# 以空格分隔打印第一列
ls -l | awk -F " " '    # 此处打个回车，然后接着往下。下面这几行也是后面有回车
{
print $1
}
'
```

```bash
# 打印第三列的值介于01:22:41和01:22:43的行
cat /var/log/messages | awk '
{
if ($3 < "01:22:43" && $3 > "01:22:41")
print $0
}
'
# print $0 表示打印一整行
```

### 管道符做统计使用

|管道符后面跟的字段|用途|
|---|---|
|wc|统计。比如`wc -l`能输出行数|
|sort|排序。`sort -g` 或者`sort -n`以数字顺序排序|
|uniq|合并相同字段。`uniq -c`不仅能合并相同的字段，并且还能输各个字段出现了几次|

### 管道符扩展功能

连用

举例：现在有一个文件`./testsort.txt`里面存了很多数字（每一行只有一个数字），并且有重复的数。要求输出出现次数最多的三个数

```bash
cat testsort.txt | sort | uniq -c | sort -rn | head -n 3
# sort -rn 是倒序顺序排序，-r是reverse，-n是number
```

### 其他未提到的

cut

sed

## 重定向

1. `>`会自动创建新文件
1. `>`会覆盖文件内容

1. `>>`会追加写入

1. `2>`表示重定向错误信息
1. `2>>`表示追加写入错误信息

1. `mkdir testfile 2> /dev/null` 表示不希望看到错误信息，就把错误信息输出到这个`/dev/null`文件中。而这个文件相当于垃圾桶，无论输入什么进去都会消失
1. `ls abc >> correct.log 2>> /dev/null`表示把正确输出重定向到`correct.log`文件，而把错误信息重定向到垃圾桶里
